<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>P.I.D.R. Game</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #fff;
            min-height: 100vh;
        }

        .main-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #1a4a7a 0%, #3390ec 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .username {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .user-id {
            font-size: 14px;
            opacity: 0.8;
        }

        .balance {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: 600;
        }

        .main-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-btn {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(26, 74, 122, 0.2);
        }

        .action-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .action-text {
            font-size: 16px;
            font-weight: 600;
            color: #1a4a7a;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #1a4a7a;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .recent-games {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a4a7a;
            margin-bottom: 15px;
        }

        .games-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .game-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e3eafc;
        }

        .game-item:last-child {
            border-bottom: none;
        }

        .game-result {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
        }

        .win {
            background: #e3fcef;
            color: #0f9d58;
        }

        .lose {
            background: #fce3e3;
            color: #d93025;
        }

        .game-info {
            flex: 1;
        }

        .game-date {
            font-size: 12px;
            color: #666;
        }

        .game-score {
            font-weight: 500;
            color: #1a4a7a;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #666;
            font-size: 12px;
        }

        .nav-item.active {
            color: #1a4a7a;
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        @media (max-width: 480px) {
            .main-actions {
                grid-template-columns: 1fr;
            }

            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <div class="user-info">
                <div class="avatar">üë§</div>
                <div class="user-details">
                    <div class="username">–ò–≥—Ä–æ–∫</div>
                    <div class="user-id">ID: 12345678</div>
                </div>
            </div>
            <div class="balance">
                <span>üí∞</span>
                <span>1000</span>
            </div>
        </div>

        <div class="main-actions">
            <button class="action-btn" onclick="window.location.href='game-setup.html'">
                <div class="action-icon">üéÆ</div>
                <div class="action-text">–ò–≥—Ä–∞—Ç—å</div>
            </button>
            <button class="action-btn" onclick="window.location.href='shop.html'">
                <div class="action-icon">üõçÔ∏è</div>
                <div class="action-text">–ú–∞–≥–∞–∑–∏–Ω</div>
            </button>
        </div>

        <div class="quick-stats">
            <div class="stat-card">
                <div class="stat-value">42</div>
                <div class="stat-label">–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">65%</div>
                <div class="stat-label">–ü–æ–±–µ–¥</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">1234</div>
                <div class="stat-label">–†–µ–π—Ç–∏–Ω–≥</div>
            </div>
        </div>

        <div class="recent-games">
            <div class="section-title">–ù–µ–¥–∞–≤–Ω–∏–µ –∏–≥—Ä—ã</div>
            <ul class="games-list">
                <li class="game-item">
                    <div class="game-result win">W</div>
                    <div class="game-info">
                        <div class="game-date">–°–µ–≥–æ–¥–Ω—è, 15:30</div>
                        <div class="game-score">–ü–æ–±–µ–¥–∞ ‚Ä¢ +25 –æ—á–∫–æ–≤</div>
                    </div>
                </li>
                <li class="game-item">
                    <div class="game-result lose">L</div>
                    <div class="game-info">
                        <div class="game-date">–°–µ–≥–æ–¥–Ω—è, 14:15</div>
                        <div class="game-score">–ü–æ—Ä–∞–∂–µ–Ω–∏–µ ‚Ä¢ -15 –æ—á–∫–æ–≤</div>
                    </div>
                </li>
                <li class="game-item">
                    <div class="game-result win">W</div>
                    <div class="game-info">
                        <div class="game-date">–í—á–µ—Ä–∞, 20:45</div>
                        <div class="game-score">–ü–æ–±–µ–¥–∞ ‚Ä¢ +30 –æ—á–∫–æ–≤</div>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item active">
            <div class="nav-icon">üéÆ</div>
            <span>–ú–µ–Ω—é</span>
        </a>
        <a href="#" class="nav-item">
            <div class="nav-icon">üë•</div>
            <span>–î—Ä—É–∑—å—è</span>
        </a>
        <a href="profile.html" class="nav-item">
            <div class="nav-icon">üë§</div>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
        <a href="#" class="nav-item">
            <div class="nav-icon">üí∞</div>
            <span>–ö–æ—à–µ–ª–µ–∫</span>
        </a>
        <a href="#" class="nav-item">
            <div class="nav-icon">üìã</div>
            <span>–ü—Ä–∞–≤–∏–ª–∞</span>
        </a>
    </nav>

    <script src="js/main.js"></script>
    <script>
    // --- –£–¥–∞–ª–∏—Ç—å checkAuth –∏ logout ---
    // --- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏–∑ Telegram WebApp ---
    window.addEventListener('DOMContentLoaded', function() {
        if (window.Telegram && window.Telegram.WebApp && Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user) {
            const tgUser = Telegram.WebApp.initDataUnsafe.user;
            document.getElementById('userName').textContent = tgUser.username || tgUser.first_name || '–ò–≥—Ä–æ–∫';
            document.getElementById('userId').textContent = 'ID: ' + tgUser.id;
            localStorage.setItem('user', JSON.stringify({
                id: tgUser.id,
                username: tgUser.username || tgUser.first_name || '–ò–≥—Ä–æ–∫',
                first_name: tgUser.first_name,
                last_name: tgUser.last_name,
                photo_url: tgUser.photo_url
            }));
        } else {
            document.getElementById('userName').textContent = '–ì–æ—Å—Ç—å';
            document.getElementById('userId').textContent = '';
            localStorage.removeItem('user');
        }
    });

    document.getElementById('shop').onclick = () => {
        window.location.href = 'shop.html';
    };
    document.getElementById('startGame').onclick = () => {
        window.location.href = 'game.html';
    };
    document.getElementById('profile').onclick = () => {
        window.location.href = 'profile.html';
    };
    function showWelcomeMessage() {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        document.body.innerHTML = '';
        // –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        const container = document.createElement('div');
        container.style.display = 'flex';
        container.style.flexDirection = 'column';
        container.style.alignItems = 'center';
        container.style.justifyContent = 'center';
        container.style.height = '100vh';
        container.style.background = 'linear-gradient(135deg, #3390ec 0%, #fff 100%)';
        // –ö–∞—Ä—Ç–∏–Ω–∫–∞ –∫–∞—Ä—Ç
        const img = document.createElement('img');
        img.src = 'img/cards/ace_of_spades.png';
        img.alt = '–ö–∞—Ä—Ç—ã';
        img.style.width = '120px';
        img.style.marginBottom = '24px';
        img.style.boxShadow = '0 8px 32px rgba(0,0,0,0.18)';
        img.style.borderRadius = '12px';
        // –°–æ–æ–±—â–µ–Ω–∏–µ
        const msg = document.createElement('div');
        msg.innerHTML = `<h2 style='color:#222;margin-bottom:10px;'>Welcome to <span style="color:#3390ec">P.I.D.R. - Punishment Inevitable: Dumb Rules</span>!</h2>
        <p style='font-size:18px;color:#444;margin-bottom:18px;'>Ready to play the wildest card game?<br>Gather your friends or challenge the bots!</p>`;
        // –ö–Ω–æ–ø–∫–∞
        const btn = document.createElement('button');
        btn.textContent = '–ò–≥—Ä–∞—Ç—å!';
        btn.className = 'game-btn';
        btn.style.fontSize = '20px';
        btn.style.padding = '14px 38px';
        btn.style.marginTop = '10px';
        btn.style.background = 'linear-gradient(90deg, #3390ec 0%, #1bffff 100%)';
        btn.style.color = '#fff';
        btn.style.border = 'none';
        btn.style.borderRadius = '10px';
        btn.style.boxShadow = '0 2px 12px rgba(51,144,236,0.13)';
        btn.style.cursor = 'pointer';
        btn.onclick = () => {
            window.location.href = 'game.html';
        };
        // –°–æ–±–∏—Ä–∞–µ–º
        container.appendChild(img);
        container.appendChild(msg);
        container.appendChild(btn);
        document.body.appendChild(container);
    }
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (welcome —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç user.id)
    try {
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        if (!user || !user.id) {
            showWelcomeMessage();
        }
    } catch {
        showWelcomeMessage();
    }
    </script>

    <!-- –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é –∏ –¥—Ä—É–∑–µ–π -->
    <div class="menu-friends-button">
        <div class="menu-icon">
            <i class="fas fa-bars"></i>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–µ–Ω—é –∏ –¥—Ä—É–∑–µ–π -->
    <div class="universal-modal" id="menu-friends-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ú–µ–Ω—é</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="menu-section">
                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø—É–Ω–∫—Ç—ã –º–µ–Ω—é -->
                </div>
                <div class="friends-section">
                    <h3>–î—Ä—É–∑—å—è</h3>
                    <div id="friendsListModal">
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="universal-modal" id="universal-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
                <button class="close-modal">&times;</button>
            </div>
            <div id="profileModalContent">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–æ—Ñ–∏–ª—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∞–≤–∏–ª -->
    <div class="universal-modal" id="universal-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ü—Ä–∞–≤–∏–ª–∞</div>
                <button class="close-modal">&times;</button>
            </div>
            <div id="rulesModalContent">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∞–≤–∏–ª –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <script>
    // --- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è ---
    window.showProfileModal = function() {
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        safeShowModal(`
            <div style="display:flex;flex-direction:column;align-items:center;">
                <img src="${user.avatar || 'img/player-avatar.svg'}" alt="–ê–≤–∞—Ç–∞—Ä" style="width:80px;height:80px;border-radius:50%;box-shadow:0 2px 8px #2196f355;margin-bottom:12px;">
                <div style="font-size:1.2em;font-weight:700;color:var(--tg-theme-text-color,#1e3c72);margin-bottom:6px;">${user.display_name || user.username || '–ì–æ—Å—Ç—å'}</div>
                <div style="color:#2196f3;font-size:1em;margin-bottom:8px;">@${user.telegram_username || ''}</div>
                <div style="color:#444;font-size:1em;margin-bottom:8px;">–†–µ–π—Ç–∏–Ω–≥: <b>${user.rating || 1000}</b></div>
                <div style="color:#444;font-size:1em;margin-bottom:8px;">ID: <b>${user.id || '-'}</b></div>
                <button class="game-btn" style="margin-top:10px;" onclick="logoutProfile()">–í—ã–π—Ç–∏</button>
            </div>
        `, {
            title: '–ü—Ä–æ—Ñ–∏–ª—å',
            onClose: () => {},
        });
    };
    window.logoutProfile = function() {
        logout();
    };

    // --- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–∞–≤–∏–ª ---
    window.showRulesModal = function() {
        safeShowModal(`
            <div class="rules-content" style="color:var(--tg-theme-text-color,#1e3c72);text-align:left;max-height:60vh;overflow-y:auto;">
                <h3 style="color:#2196f3;">–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã "P.I.D.R. - Punishment Inevitable: Dumb Rules"</h3>
                <h4>–¶–µ–ª—å –∏–≥—Ä—ã</h4>
                <p>–ò–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –≤—Å–µ—Ö –∫–∞—Ä—Ç –Ω–∞ —Ä—É–∫–µ —Ä–∞–Ω—å—à–µ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤.</p>
                <h4>–ö–æ–ª–æ–¥–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞</h4>
                <p>–ò–≥—Ä–∞ –≤–µ–¥–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –∫–æ–ª–æ–¥–æ–π –∏–∑ 52 –∫–∞—Ä—Ç (–æ—Ç 2 –¥–æ —Ç—É–∑–∞).</p>
                <p>–ö–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É —Ä–∞–∑–¥–∞—é—Ç—Å—è 3 –∫–∞—Ä—Ç—ã: 2 –∑–∞–∫—Ä—ã—Ç—ã–µ –∏ 1 –æ—Ç–∫—Ä—ã—Ç–∞—è.</p>
                <h4>–•–æ–¥ –∏–≥—Ä—ã</h4>
                <p><strong>–°—Ç–∞–¥–∏—è 1:</strong> –í—ã–∫–ª–∞–¥–∫–∞ –∫–∞—Ä—Ç</p>
                <ul>
                    <li>–ò–≥—Ä–æ–∫–∏ —Ö–æ–¥—è—Ç –ø–æ –æ—á–µ—Ä–µ–¥–∏. –ù–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä–æ–∫ —Å —Å–∞–º–æ–π —Å—Ç–∞—Ä—à–µ–π –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–∞—Ä—Ç–æ–π.</li>
                    <li>–í —Å–≤–æ–π —Ö–æ–¥ –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –ø–æ–ª–æ–∂–∏—Ç—å —Å–≤–æ—é –∫–∞—Ä—Ç—É –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—É—é –∫–∞—Ä—Ç—É –ª—é–±–æ–≥–æ –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–∞ 1 —Ä–∞–Ω–≥ –≤—ã—à–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 7 –Ω–∞ 6).</li>
                    <li>–¢—É–∑ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–∞–º—ã–º —Å—Ç–∞—Ä—à–∏–º, –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å —Ç–æ–ª—å–∫–æ 2 –Ω–∞ —Ç—É–∑–∞.</li>
                    <li>–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ö–æ–¥–∞ –∏–≥—Ä–æ–∫ –±–µ—Ä—ë—Ç –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –∏–∑ –∫–æ–ª–æ–¥—ã –∏ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ö–æ–¥–∏—Ç—å, –ø–æ–∫–∞ —É –Ω–µ–≥–æ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥.</li>
                    <li>–ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥ –∫–∞—Ä—Ç–∞–º–∏ –∏–∑ —Ä—É–∫–∏ (–ø–æ–ª–æ–∂–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç—ã –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤), –æ–Ω –º–æ–∂–µ—Ç –ø–æ–ª–æ–∂–∏—Ç—å –∫–∞—Ä—Ç—É –Ω–∞ —Å–≤–æ—é –æ—Ç–∫—Ä—ã—Ç—É—é –∫–∞—Ä—Ç—É –ø–æ —Ç–µ–º –∂–µ –ø—Ä–∞–≤–∏–ª–∞–º.</li>
                    <li>–ï—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, –∏–≥—Ä–æ–∫ –±–µ—Ä—ë—Ç –∫–∞—Ä—Ç—É –∏–∑ –∫–æ–ª–æ–¥—ã –∏ –µ–≥–æ —Ö–æ–¥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.</li>
                    <li>–°—Ç–∞–¥–∏—è –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –∫–æ–ª–æ–¥–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è.</li>
                </ul>
                <p><strong>–°—Ç–∞–¥–∏—è 2:</strong> –°–±—Ä–æ—Å –∫–∞—Ä—Ç</p>
                <ul>
                    <li>–í—Å–µ –∑–∞–∫—Ä—ã—Ç—ã–µ –∫–∞—Ä—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è.</li>
                    <li>–ò–≥—Ä–æ–∫–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏ —Å–∫–∏–¥—ã–≤–∞—é—Ç –∫–∞—Ä—Ç—ã –≤ —Ü–µ–Ω—Ç—Ä –ø–æ –ø—Ä–∞–≤–∏–ª—É: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–Ω–≥ –∏–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –º–∞—Å—Ç—å.</li>
                    <li>–ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ –º–æ–∂–µ—Ç —Å—Ö–æ–¥–∏—Ç—å, –æ–Ω –±–µ—Ä—ë—Ç –∫–∞—Ä—Ç—É –∏–∑ –∫–æ–ª–æ–¥—ã.</li>
                    <li>–ï—Å–ª–∏ –∫–æ–ª–æ–¥–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å, —Å–±—Ä–æ—Å –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ—Ç—Å—è –∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤–æ–π –∫–æ–ª–æ–¥–æ–π.</li>
                </ul>
                <h4>–ü–æ–±–µ–¥–∞</h4>
                <p>–ü–æ–±–µ–∂–¥–∞–µ—Ç –∏–≥—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–≤—ã–º –∏–∑–±–∞–≤–∏—Ç—Å—è –æ—Ç –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –∫–∞—Ä—Ç.</p>
            </div>
        `, {
            title: '–ü—Ä–∞–≤–∏–ª–∞',
            onClose: () => {},
        });
    };

    // --- –ù–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ ---
    var profilePageBtn = document.getElementById('profile');
    if (profilePageBtn) profilePageBtn.onclick = showProfileModal;
    var rulesBtn = document.getElementById('rules');
    if (rulesBtn) rulesBtn.onclick = showRulesModal;

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏ –¥—Ä—É–∑–µ–π
    const menuFriendsBtn = document.querySelector('.menu-friends-button');
    const menuFriendsModal = document.getElementById('menu-friends-modal');
    const closeModalBtn = menuFriendsModal ? menuFriendsModal.querySelector('.close-modal') : null;

    if (menuFriendsBtn && menuFriendsModal) {
        menuFriendsBtn.addEventListener('click', () => {
            menuFriendsModal.classList.add('active');
            loadFriends(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        });
    }
    if (closeModalBtn && menuFriendsModal) {
        closeModalBtn.addEventListener('click', () => {
            menuFriendsModal.classList.remove('active');
        });
    }
    if (menuFriendsModal) {
        menuFriendsModal.addEventListener('click', (e) => {
            if (e.target === menuFriendsModal) {
                menuFriendsModal.classList.remove('active');
            }
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π
    async function loadFriends() {
        try {
            const response = await fetch('/api/friends');
            if (!response.ok) {
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä—É–∑–µ–π: ' + response.status, 'error');
                document.getElementById('friendsListModal').innerHTML = 
                    '<div class="no-results">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</div>';
                return;
            }
            const data = await response.json();

            const friendsHtml = data.friends && data.friends.length ?
                data.friends.map(friend => `
                    <div class="friend-item">
                        <img src="${friend.avatar_url || '/images/default-avatar.png'}" class="friend-avatar" alt="${friend.username}">
                        <div class="friend-info">
                            <div class="friend-name">${friend.display_name || friend.username}</div>
                            <div class="friend-status ${friend.online ? 'online' : 'offline'}">
                                ${friend.online ? '–í —Å–µ—Ç–∏' : '–ù–µ –≤ —Å–µ—Ç–∏'}
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-action-btn invite-btn" onclick="inviteFriend('${friend.id}')">
                                <i class="fas fa-user-plus"></i>
                            </button>
                            <button class="friend-action-btn play-btn" onclick="playWithFriend('${friend.id}')">
                                <i class="fas fa-gamepad"></i>
                            </button>
                        </div>
                    </div>
                `).join('') :
                '<div class="no-results">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</div>';

            document.getElementById('friendsListModal').innerHTML = friendsHtml;
        } catch (error) {
            showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä—É–∑–µ–π', 'error');
            document.getElementById('friendsListModal').innerHTML = 
                '<div class="no-results">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</div>';
        }
    }
    </script>
</body>
</html> 